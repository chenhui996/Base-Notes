# 面试官：webpack 原理都不会？

## 引言

- 前一段时间我把 webpack 源码大概读了一遍;
- webpack 到 4.x 版本后，其源码已经比较庞大;
- 对各种开发场景进行了高度抽象;
  - 阅读成本也愈发昂贵;

<br>

- 过度分析源码对于大家并没有太大的帮助;
- 本文主要是想通过分析 webpack 的:
  - '构建流程'以及'实现'一个简单的 webpack;
  - 让大家对 webpack 的'内部原理'有一个大概的了解;

## webpack 构建流程分析

- entry-option: 初始化流程;
- run: 开始编译;
- make: 从 entry 开始'递归的'分析依赖，对每个'依赖模块'进行 build;
- before-resolve: 对'模块位置'进行解析;
- build-module: 开始'构建'某个'模块';
- normal-module-loader: 将 loader 加载完成的 module 进行编译，生成 AST 树;
- program: 遍历 AST 树，当遇到 require 等一些调用表达式时，收集依赖;
- seal: 所有依赖 build 完成，开始优化;
- emit: 输出到 dist 目录;
  <br>
- webpack 的'运行流程'是一个'串行'的过程;
- 从启动到结束会依次执行以下流程:
  - 首先会从'配置文件'和 'Shell 语句'中'读取'与'合并'参数;
    - 并初始化'需要使用的插件'和'配置插件'等'执行环境'所需要的参数;
  - 初始化完成后会调用 Compiler 的 run:
    - 来真正启动 webpack'编译构建'过程;
  - webpack 的构建流程包括:
    - compile
    - make
    - build
    - seal
    - emit
- 执行完这些阶段就完成了构建过程;

### 阿辉个人小结（笔记）：

- (个人当前理解，后面随着学习深入，会逐步进行调整)
  <br>
- 简单的说，webpack 的构建流程就是：
  - 先用 compiler 的 run 命令启动编译;
  - 然后再开始递归分析所有"依赖模块"，对每个"依赖模块"进行 build；
  - build 步骤要细：
    - 先分析模块位置；
    - 开始构建一个个模块；
    - 将所有模块生成 AST 树进行遍历；
    - 遍历过程中遇到 require 等一些调用表达式时，收集依赖;
    - 所有模块构建与依赖收集完毕,开始优化;
    - 最后，输出到 dist 目录;
