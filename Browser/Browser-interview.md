# 浏览器相关（可直接当作面试题）

## Chrome 架构：仅仅打开了 1 个页面，为什么有 4 个进程

- **线程和进程区别：**
  - 多线程可以**并行**处理任务。
  - **线程**不能单独存在，它是由**进程**来启动和管理的。一个**进程**是一个程序的**运行实例**。
- **线程和进程的关系：**
  - 进程中任意一**线程**执行出错，**都会导致整个进程的崩溃**。
  - **线程**之间共享**进程**中的**数据**。
  - 当一个**进程**关闭后，**操作系统**会**回收进程所占用**的**内存**。
  - **进程**之间的**内容**相互**隔离**。
- **单进程浏览器：**
  - 不稳定：
    - 单进程中的**插件、渲染线程**崩溃导致整个**浏览器崩溃**。
  - 不流畅：
    - 脚本（死循环）或插件会使**浏览器卡顿**。
  - 不安全：
    - **插件和脚本**可以获取到**操作系统任意资源**。
- **多进程浏览器：**
  - 解决不稳定：
    - **进程**相互隔离：
      - 一个**页面或者插件**崩溃时 -> 仅影响时当前插件或者页面，不会影响到其他页面。
  - 解决不流畅:
    - **脚本**阻塞**当前页面**渲染进程，不会影响到其他页面。
  - 解决不安全:
    - 采用**多进程架构**使用**沙箱**:
      - **沙箱**看成是**操作系统**给**进程**上了一把锁：
        - **沙箱的程序**可以运行：
          - 但是**不能**在**硬盘**上**写入**任何数据，也**不能**在敏感位置**读取**任何数据。
- **多进程架构：**
  - 分为：
    - 浏览器进程
    - 渲染进程
    - GPU 进程
    - 网络进程
    - 插件进程
  - 缺点：
    - 资源占用高。
    - 体系架构复杂。
- **面向服务架构：**
  - 把原来的各种模块**重构**成：
    - 独立的服务。
  - 每个服务都可以：
    - 在**独立的进程**中运行。
  - **访问服务**必须使用**定义好的接口**
  - 通过 IPC 通讯：
    - 使得系统：
      - 更内聚
      - 松耦合
      - 易维护
      - 拓展

## TCP 协议：如何保证页面文件能被完整送达浏览器

- IP 头：
  - **IP 数据包**开头的信息，包含：
    - IP 版本
    - 源 IP 地址
    - 目标 IP 地址
    - 生存时间
    - 等
- UDP 头中除了**目的端口**：
  - 还有**源端口号**等信息。
- IP 负责：
  - 把**数据包**送达**目的主机**。
- UDP 负责：
  - 把**数据包**送达**具体应用**。
- 对于错误的数据包：
  - UDP 不提供**重发机制**，只是**丢弃当前的包**
  - 不能保证**数据的可靠性**，但是**传输速度非常块**
- TCP 头除了包含:
  - **目标端口**和**本机端口号**外:
    - 还提供了**用于排序的序列号**:
      - 保证了**数据完整地传输** -> 它的连接可分为三个阶段：**建立连接**、**传输数据**和**断开连接**；

## HTTP 请求流程：为什么很多站点第二次打开速度会很快

- 浏览器中的 HTTP 请求:
  - 从**发起到结束**一共经历如下**八个阶段**：
    - 构建请求
    - 查找缓存
    - 准备 IP 和端口
    - 等待 TCP 队列
    - 建立 TCP 连接
    - 发起 HTTP 请求
    - 服务器处理请求
    - 服务器返回请求
    - 断开连接

### 构建请求

- 浏览器**构建请求行** -> 构建好后，准备**发起网络请求**。

### 查找缓存

- 在真正发起请求前：
  - 浏览器会查询：
    - **缓存中** -> 是否有**请求资源副本**
      - 有则拦截请求，返回资源副本
      - 否则进入**网络请求**

### 准备 IP 地址和端口

- HTTP 网络请求 -> 需要和服务器建立 -> **TCP 连接**
  - 而建立 TCP 连接需要准备:
    - IP 地址
    - 端口号
  - 浏览器需要:
    - 请求 DNS **返回域名对应的 IP**。
  - 同时会**缓存**域名解析结果，供下次查询使用。

### 等待 TCP 队列

- Chrome 机制:
  - **同一个域名**同时最多只能建立 **6** 个 **TCP 连接**。

### 建立 TCP 连接

- TCP 通过：
  - “三次握手”建立连接 -> **传输数据** -> “四次挥手”断开连接

### 发送 HTTP 请求

- 建立 TCP 连接后:
  - **浏览器**就可以和**服务器**进行 **HTTP 数据传输**
    - 首先会向**服务器**发送**请求行**
    - 然后以**请求头**形式**发送**一些**其他信息**
    - 如果是 **POST 请求**还会**发送请求体**

### 服务器处理请求

- 首先:
  - **服务器**会**返回响应行**
- 随后:
  - **服务器**向**浏览器**发送**响应头**和**响应体**
- 通常服务器返回数据:
  - 就要关闭 TCP 连接。
  - 如果**请求头**或者**响应头**有 Connection:keep-alive TCP -> **保持打开状态**

### 导航流程：从输入 URL 到页面展示这中间发生了什么

...
