# babel-learn

ä¸‹é¢æˆ‘éƒ½å°†å›´ç»•è¿™ä¸ªbabel-basicé¡¹ç›®æ¥è¿›è¡Œè®²è§£.

å¸Œæœ›ä½ ä¹Ÿèƒ½åœ¨æœ¬åœ°å‡†å¤‡ä¸€ä¸ªè¿™æ ·çš„é¡¹ç›®æ¡ˆä¾‹, ä»¥ä¾¿ä½ æ›´å¥½çš„ç†è§£æˆ‘æ¥ä¸‹æ¥è¦è¯´çš„å†…å®¹.

## @babel/core

æˆ‘ä»¬å­¦ä¹  Babel, é¦–å…ˆè¦äº†è§£ä¸€ä¸ªå« @babel/core çš„ä¸œè¥¿, å®ƒæ˜¯ Babel çš„ "æ ¸å¿ƒæ¨¡å—".

å½“ç„¶è¦ä½¿ç”¨å®ƒ, æˆ‘ä»¬å¾—å…ˆå®‰è£…ï¼š

```shell
$npm i --save-dev @babel/core
```

å®‰è£…æˆåŠŸä¹‹å, å°±å¯ä»¥åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ä½¿ç”¨äº†, ä½ å¯ä»¥é‡‡ç”¨CommonJSçš„å¼•ç”¨æ–¹å¼ï¼š

```js
const babel = require('@babel/core');
babel.transform("code", options);
```

> è¿™é‡Œçš„çŸ¥è¯†ç‚¹æœ‰å¾ˆå¤š, ä¸è¿‡ä½ ä¸ç”¨æ€¥äºçš„æŒæ¡å®ƒ, åªéœ€è¦çŸ¥é“å®ƒæ˜¯ Babel çš„æ ¸å¿ƒ, è®©æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹.

---

## @babel/cli

å†ç„¶åå°±æ˜¯ @babel/cliï¼š

- ä¸€ä¸ªç»ˆç«¯è¿è¡Œå·¥å…·
- å†…ç½®çš„æ’ä»¶

è¿è¡Œä½ ä» "ç»ˆç«¯" ä½¿ç”¨ "babelçš„å·¥å…·".

åŒæ ·, å®ƒä¹Ÿéœ€è¦å…ˆå®‰è£…:

```shell
$npm i --save-dev @babel/cli @babel/core
```

è®©æˆ‘ä»¬å®‰è£… @babel/cli çš„åŒæ—¶, å†æ¥å®‰è£…ä¸€ä¸‹ @babel/core.

ç°åœ¨, è®©æˆ‘å…ˆåœ¨ src/index.js ä¸­å†™ä¸Šä¸€æ®µç®€å•çš„ä»£ç , å¹¶æ¥çœ‹çœ‹å®ƒçš„ "åŸºæœ¬ç”¨æ³•".

### src/index.js:

```js
const fn = () => 1; // ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1
console.log(fn());
```

### ç”¨æ³•ä¸€: å‘½ä»¤è¡Œçš„å½¢å¼

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œè¯­å¥:

```shell
$./node_modules/.bin/babel src --out-dir lib
```

è¿™æ®µè¯­å¥çš„æ„æ€æ˜¯: 

- ä½¿ç”¨ï¼šæˆ‘ä»¬è®¾ç½®çš„è§£ææ–¹å¼, æ¥è§£æ -> src ç›®å½•ä¸‹çš„ "æ‰€æœ‰JSæ–‡ä»¶".
- å°† "è½¬æ¢å" çš„ "æ¯ä¸ªæ–‡ä»¶" éƒ½ "è¾“å‡º"åˆ° "libç›®å½•" ä¸‹.

ä½†æ˜¯æ³¨æ„äº†, ç”±äºæˆ‘ä»¬ç°åœ¨æ²¡æœ‰è®¾ç½® "ä»»ä½•çš„è§£ææ–¹å¼".(.babelrc)

æ‰€ä»¥ä½ åœ¨æ‰§è¡Œäº†è¿™æ®µè¯­å¥ä¹‹åï¼š

- èƒ½çœ‹åˆ° "é¡¹ç›®" ä¸­å¤šäº†ä¸€ä¸ª lib ç›®å½•.
  - è€Œä¸”é‡Œé¢çš„ "JSä»£ç " å’Œ "srcä¸­çš„" æ˜¯ **ä¸€æ ·** çš„.
- è‡³äº "è§£ææ–¹å¼", å°±æ˜¯åé¢è¦ä»‹ç»çš„ï¼š
  - **plugins**
  - **presets**

å¦å¤–, å¦‚æœä½ æ˜¯npm@5.2.0é™„å¸¦çš„npmåŒ…è¿è¡Œå™¨çš„è¯, å°±å¯ä»¥ç”¨ npx babel æ¥ä»£æ›¿ ./node_modules/.bin/babel :

```shell
$npx babel src --out-dir lib
```

### ç”¨æ³•äºŒ: ç»™package.jsonä¸­é…ç½®ä¸€æ®µè„šæœ¬å‘½ä»¤:

```json
{
    "name": "babel-basic",
    "version": "1.0.0",
    "description": "",
    "main": "index.js",
    "scripts": {
      "build": "babel src -d lib"
    },
    "keywords": [],
    "author": "",
    "license": "ISC",
    "devDependencies": {
       "@babel/cli": "^7.8.4",
       "@babel/core": "^7.8.4"
    }
}
```

ç°åœ¨è¿è¡Œnpm run buildæ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„, -d æ˜¯ --out-dir çš„ç¼©å†™...

- æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢çš„ --out-dir é€‰é¡¹.
  - ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ --help è¿è¡Œå®ƒæ¥æŸ¥çœ‹ cli å·¥å…·æ¥å—çš„ "å…¶ä½™é€‰é¡¹".

```shell
$npx babel --help
```

**ä½†å¯¹æˆ‘ä»¬æ¥è¯´ "æœ€é‡è¦" çš„æ˜¯ --plugins å’Œ --presets.**

---

## æ’ä»¶plugins

### åŸºæœ¬æ¦‚å¿µ

çŸ¥é“äº† Babel çš„ "åŸºæœ¬ç”¨æ³•" ä¹‹å, è®©æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„ "ä»£ç è½¬æ¢".

ç°åœ¨è¦ä»‹ç»çš„æ˜¯**æ’ä»¶ plugins**, å®ƒçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª "JSç¨‹åº", æŒ‡ç¤ºç€ **Babel å¦‚ä½•å¯¹ä»£ç è¿›è¡Œè½¬æ¢**.

> æ‰€ä»¥ä½ ä¹Ÿå¯ä»¥ "ç¼–å†™è‡ªå·±çš„æ’ä»¶", æ¥åº”ç”¨ä½ æƒ³è¦çš„ "ä»»ä½•ä»£ç è½¬æ¢".

### æ’ä»¶æ¡ˆä¾‹(ç®­å¤´å‡½æ•°æ’ä»¶)

å…ˆå­¦ä¹ ä¸€äº›åŸºæœ¬çš„æ’ä»¶.

å¦‚æœä½ æ˜¯è¦å°† ES6+ è½¬æˆ ES5, å¯ä»¥ä¾èµ–**å®˜æ–¹æ’ä»¶,** ä¾‹å¦‚:

```@babel/plugin-transform-arrow-functions```:

```shell
$cnpm i --save-dev @babel/plugin-transform-arrow-functions
$npx babel src --out-dir lib --plugins=@babel/plugin-transform-arrow-functions
```

è¿™ä¸ªæ’ä»¶çš„ä½œç”¨æ˜¯, å°† "ç®­å¤´å‡½æ•°" è½¬æ¢ä¸º ES5 å…¼å®¹çš„å‡½æ•°.

è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰çš„ src/index.js å—:

ç°åœ¨ç¼–è¯‘ä¹‹å, ä½ å†æ‰“å¼€ lib/index.js æ¥çœ‹çœ‹.

å®ƒæ˜¯ä¸æ˜¯è¢«è½¬æ¢ä¸ºES5çš„ä»£ç äº†å‘¢? ğŸ˜

```js
const fn = function () {
  return 1;
}; // ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1


console.log(fn());
```

æ£é¼“äº†è¿™ä¹ˆä¹…, ç»ˆäºçœ‹åˆ°äº†ä¸€ç‚¹å®é™…çš„æ•ˆæœ, æ­¤æ—¶æœ‰ç‚¹å°å…´å¥‹å•ŠğŸ˜„

è™½ç„¶æˆ‘ä»¬å·²ç»å®ç°äº† "ç®­å¤´å‡½æ•°è½¬æ¢" çš„åŠŸèƒ½, ä½†æ˜¯ ES6+ å…¶å®ƒçš„è¯­æ³•(æ¯”æ±‚å¹‚è¿ç®—ç¬¦**)å´å¹¶ä¸èƒ½è½¬æ¢:

- è¿™æ˜¯å› ä¸º:
  - æˆ‘ä»¬åªä½¿ç”¨äº†:
    - @babel/plugin-transform-arrow-functionsè¿™ä¸ªåŠŸèƒ½æ’ä»¶, æ²¡æœ‰ä½¿ç”¨å…¶å®ƒçš„äº†.

---

## presets:

### åŸºæœ¬æ¦‚å¿µ

å¦‚æœæƒ³è¦è½¬æ¢ ES6+ çš„ "å…¶å®ƒä»£ç " ä¸º ES5.

å¯ä»¥ä½¿ç”¨ "preset" æ¥ "ä»£æ›¿" é¢„å…ˆè®¾å®šçš„ "ä¸€ç»„æ’ä»¶", è€Œä¸æ˜¯ "é€ä¸€æ·»åŠ " æˆ‘ä»¬æƒ³è¦çš„æ‰€æœ‰æ’ä»¶.

**è¿™é‡Œå¯ä»¥ç†è§£ä¸º "ä¸€ä¸ª preset" å°±æ˜¯ "ä¸€ç»„æ’ä»¶" çš„ "é›†åˆ"**

presets å’Œ plugins ä¸€æ ·, ä¹Ÿå¯ä»¥ "åˆ›å»ºè‡ªå·±çš„ preset", "åˆ†äº«" ä½ éœ€è¦çš„ "ä»»ä½•æ’ä»¶ç»„åˆ".

### @babel/preset-env

ä¾‹å¦‚, æˆ‘ä»¬ä½¿ç”¨ ```env``` preset:

```shell
$cnpm i --save-dev @babel/preset-env
```

**```env``` preset**:

- è¿™ä¸ªpresetåŒ…, æ”¯æŒç°ä»£ JavaScript(ES6+) çš„æ‰€æœ‰æ’ä»¶.
  - ä¹Ÿå°±æ˜¯è¯´ä½ å®‰è£…ä½¿ç”¨äº† ```env``` preset ä¹‹å.
  - å°±å¯ä»¥çœ‹åˆ°å…¶å®ƒ "ES6+ è¯­æ³•çš„è½¬æ¢" äº†.

ç°åœ¨è®©æˆ‘ä»¬æ¥ç”¨ç”¨ ES7 ä¸­çš„, "æ±‚å¹‚è¿ç®—ç¬¦" å’Œ "å‡½æ•°å‚æ•°æ”¯æŒå°¾éƒ¨é€—å·" è¿™ä¸¤ä¸ªåŠŸèƒ½å§:

### src/index.js:

```js
const fn = () => 1; // ES6ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1
let num = 3 ** 2; // ES7æ±‚å¹‚è¿ç®—ç¬¦
let foo = function(a, b, c, ) { // ES7å‚æ•°æ”¯æŒå°¾éƒ¨é€—å·
    console.log('a:', a)
    console.log('b:', b)
    console.log('c:', c)
}
foo(1, 3, 4)
console.log(fn());
console.log(num);
```

ç„¶ååœ¨ "å‘½ä»¤è¡Œ" é‡Œä½¿ç”¨è¿™ä¸ª preset:

```shell
$npx babel src --out-dir lib --presets=@babel/preset-env
```

ç°åœ¨æ‰“å¼€ lib/src çœ‹çœ‹:

```js
"use strict";

var fn = function fn() {
  return 1;
}; // ç®­å¤´å‡½æ•°, è¿”å›å€¼ä¸º1


var num = Math.pow(3, 2);

var foo = function foo(a, b, c) {
  console.log('a:', a);
  console.log('b:', b);
  console.log('c:', c);
};

foo(1, 3, 4);
console.log(fn());
console.log(num);
```

"æ±‚å¹‚è¿ç®—ç¬¦" è¢« "è½¬æ¢" ä¸ºæˆ ```Math.pow()```

"å‡½æ•°å‚æ•°" çš„ "æœ€åä¸€ä¸ªé€—å·" ä¹Ÿè¢«å»æ‰äº†.

### å°ç»“

- æˆªæ­¢åˆ°ç°åœ¨, çœ‹å®Œäº†ï¼š
  - @babel/core
  - @babel/cli
  - plugins
  - presets
- ç›¸ä¿¡ä½ å¯¹Babelçš„åŠŸèƒ½æœ‰ä¸€å®šäº†è§£äº†ã€‚
- **ä½†æ˜¯çœŸæ­£ä½¿ç”¨èµ·æ¥æˆ‘ä»¬ä¸å¯èƒ½éƒ½æ˜¯é å‘½ä»¤è¡Œçš„å½¢å¼å§**
  - **æ²¡é”™, æ¥ä¸‹æ¥æˆ‘è¦å°†è¿™äº›åŠŸèƒ½åšæˆé…ç½®é¡¹.**
    - ä¹Ÿå°±æ˜¯å¸¸è¯´çš„ .babelrc æ–‡ä»¶

---



