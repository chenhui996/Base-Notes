### HTTP 缓存机制

- Web 缓存大致可以分为:
  - 数据库缓存;
  - 服务器端缓存（代理服务器缓存、CDN 缓存）;
  - 浏览器缓存;

## 浏览器缓存

- 浏览器缓存也包含很多内容:
  - HTTP 缓存;
  - indexDB;
  - cookie;
  - localstorage;
  - 等等;
- 这里我们只讨论 HTTP 缓存相关内容;

# HTTP 缓存

- 在具体了解 HTTP 缓存之前先来明确几个术语:
  - 缓存命中率:
    - 从'缓存中'得到'数据'的'请求数'与'所有请求数'的'比率';
    - 理想状态是越高越好;
  - 过期内容:
    - 超过设置的有效时间，被标记为“陈旧”的内容;
    - 通常'过期内容不能用于回复'客户端的请求:
      - 必须重新向源服务器请求新的内容;
      - 或者'验证缓存'的内容是否仍然准备;
  - 验证:
    - 验证缓存中的过期内容是否仍然有效;
    - 验证通过的话刷新过期时间;
  - 失效:
    - 失效就是把内容从缓存中移除;
    - 当内容发生改变时就必须移除失效的内容;
- 浏览器缓存主要是 HTTP 协议定义的缓存机制;
  - HTML meta 标签，例如:

```html
<meta http-equiv="Pragma" content="no-store" />
```

- 含义是让浏览器不缓存当前页面;
- 但是代理服务器不解析 HTML 内容;
  - 一般应用广泛的是用 HTTP 头信息控制缓存;

# 浏览器缓存分类

- 浏览器缓存分为:
  - 强缓存;
  - 协商缓存;
- 浏览器加载一个页面的简单流程如下：
  - 浏览器先根据这个'资源'的'http 头信息'来判断是否命中'强缓存';
    - 如果命中则直接'加载'缓存中的资源,并'不会将请求'发送到'服务器';
  - 如果未命中'强缓存':
    - 则'浏览器'会将'资源加载请求'发送到'服务器';
      - 服务器来判断'浏览器本地缓存'是否失效;
      - 若可以使用，则服务器并不会返回资源信息;
      - 浏览器继续从缓存加载资源;
  - 如果未命中'协商缓存':
    - 则服务器会将完整的资源返回给浏览器;
    - 浏览器加载新资源，并更新缓存
